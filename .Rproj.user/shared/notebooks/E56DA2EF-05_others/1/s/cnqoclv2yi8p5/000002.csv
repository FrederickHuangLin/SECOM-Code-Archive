"0","set.seed(123)"
"0","n = 100"
"0","abn_mean = c(200, 200)"
"0","dispersion = 2"
"0","template_var = sapply(abn_mean, function(x) "
"0","    log((x + dispersion * x^2)/x^2 + 1))"
"0","template_mean = log(abn_mean) - template_var/2"
"0","mu = template_mean"
"0","std = rep(NA, length(mu))"
"0","for (i in seq_along(template_mean)) {"
"0","  std[mu == template_mean[i]] = sqrt(template_var[i])"
"0","}"
"0","R = diag(1, nrow = length(mu))"
"0","Sigma = cor2cov(R = R, std = std)"
"0",""
"0","a = t(MASS::mvrnorm(n = n, mu = mu, Sigma = Sigma))"
"0","A = round(exp(a))"
"0",""
"0","S_list = c(0.1, 0.05, 0.02, 0.01, 0.005)"
"0","res1 = data.frame(S = S_list, zero_prop = NA, "
"0","                  r_complete = NA, lo_complete = NA, up_complete = NA,"
"0","                  r_impute = NA, lo_impute = NA, up_impute = NA)"
"0",""
"0","for (i in seq_along(S_list)) {"
"0","  S = S_list[i]"
"0","  O = floor(A * S)"
"0","  res1$zero_prop[i] = sum(O == 0) / (2 * n)"
"0","  "
"0","  o = log(O); o[is.infinite(o)] = NA"
"0","  df = data.frame(t(o))"
"0","  colnames(df) = c(""o1"", ""o2"")"
"0","  "
"0","  df_impute = mice(df, m = 1, maxit = 50, meth = ""pmm"", seed = 123, print = FALSE)"
"0","  df_fill = complete(df_impute, 1)"
"0","  "
"0","  res_complete = cor.test(df$o1, df$o2)"
"0","  res1$r_complete[i] = res_complete$estimate"
"0","  res1$lo_complete[i] = res_complete$conf.int[1]"
"0","  res1$up_complete[i] = res_complete$conf.int[2]"
"0","  "
"0","  res_impute = cor.test(df_fill$o1, df_fill$o2)"
"0","  res1$r_impute[i] = res_impute$estimate"
"0","  res1$lo_impute[i] = res_impute$conf.int[1]"
"0","  res1$up_impute[i] = res_impute$conf.int[2]"
"0","}"
"0",""
"0","df_fig1 = res1 %>%"
"0","  select(-contains(""impute"")) %>%"
"0","  rename(r = r_complete, lo = lo_complete, up = up_complete) %>%"
"0","  mutate(type = ""CCA"") %>%"
"0","  bind_rows("
"0","    res1 %>%"
"0","      select(-contains(""complete"")) %>%"
"0","      rename(r = r_impute, lo = lo_impute, up = up_impute) %>%"
"0","      mutate(type = ""MICE"")"
"0","  ) %>%"
"0","  mutate_if(is.numeric, function(x) round(x, 3))"
"0","df_fig1$S = factor(df_fig1$S, levels = S_list)"
"0",""
"0","p_impute1 = df_fig1 %>%"
"0","  ggplot(aes(x = S, y = r, fill = type)) +"
"0","  geom_bar(stat = ""identity"", color = ""black"", "
"0","           position = position_dodge()) +"
"0","  geom_errorbar(aes(ymin = lo, ymax = up), width = .2,"
"0","                position = position_dodge(.9)) +"
"0","  labs(x = ""Sampling fraction"", y = ""Correlation coefficient estimate"", title = ""Uncorrelated Pair"") +"
"0","  scale_fill_npg(name = NULL) +"
"0","  theme_bw() +"
"0","  theme(plot.title = element_text(hjust = 0.5))"
"0",""
"0","datatable(df_fig1)"
