"0","set.seed(123)"
"0","n = 50"
"0","d = 100"
"0","mu = c(rep(NA, 4), # Taxa with correlations"
"0","       10000, 10000, # High abundant taxa"
"0","       sample(c(200, 50), d - 6, replace = TRUE, prob = c(0.8, 0.2))) # Low abundant taxa"
"0","# NB distribution"
"0","dispersion = 0.5"
"0",""
"0","# Absolute abundances"
"0","A = matrix(NA, ncol = n, nrow = d)"
"0","for (i in seq.int(from = 5, to = d)) {"
"0","  A[i, ] = rnbinom(n = n, size = 1/dispersion, mu = mu[i])"
"0","}"
"0",""
"0","# Dependent pairs of taxa"
"0","abn_mean = c(2000, 2000)"
"0","template_var = log((abn_mean + dispersion * abn_mean^2)/abn_mean^2 + 1)"
"0","template_mean = log(abn_mean) - template_var/2"
"0",""
"0","Sigma = cor2cov(R = diag(1, nrow = 2), std = sqrt(template_var))"
"0","template = t(MASS::mvrnorm(n = n, mu = template_mean, Sigma = Sigma))"
"0","template1 = template[1, ]"
"0","template2 = template[2, ]"
"0","poly1 = template_mean[1] * poly(x = template1, degree = 1, raw = FALSE)[, 1] + template_mean[1]"
"0","poly2 = template_mean[2] * poly(x = template2, degree = 2, raw = FALSE)[, 2] + template_mean[2]"
"0","A_dep = round(exp(rbind(template, poly1, poly2)))"
"0",""
"0","for (i in 1:4) {"
"0","  A[i, ] = A_dep[i, ]"
"0","}"
"0","mu[1:2] = 2000"
"0","mu[3:4] = 10000"
"0",""
"0","taxa_id = paste0(""T"", seq_len(d))"
"0","sample_id = paste0(""S"", seq_len(n))"
"0","rownames(A) = taxa_id"
"0","colnames(A) = sample_id"
"0",""
"0","p_a = data.frame(t(log(A[1:5, ]))) %>% "
"0","  ggpairs(title = ""Synthetic Log Absolute Abundances"","
"0","          progress = FALSE,"
"0","          upper = NULL, diag = NULL) +"
"0","  theme_bw() + "
"0","  theme(plot.title = element_text(hjust = 0.5),"
"0","        strip.background = element_rect(fill = ""white""))"
"0","print(p_a)"
