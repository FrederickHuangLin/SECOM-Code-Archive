"0","linear_data_generation = function(n, d, d1, corr_mu, corr_prob, "
"0","                                  uncorr_mu, uncorr_prob, dispersion, seed) {"
"0","  set.seed(seed)"
"0","  d2 = d - d1"
"0","  "
"0","  mu = c(sample(corr_mu, d1, replace = TRUE, prob = corr_prob), # Correlated taxa"
"0","         sample(uncorr_mu, d2, replace = TRUE, prob = uncorr_prob)) # Uncorrelated taxa"
"0","  "
"0","  # Absolute abundances"
"0","  A = matrix(NA, ncol = n, nrow = d)"
"0","  for (i in seq_len(d)) {"
"0","    A[i, ] = rnbinom(n = n, size = 1/dispersion, mu = mu[i])"
"0","  }"
"0","  "
"0","  for (i in seq(2, d1, 2)) {"
"0","    A[i, ] = poly(x = A[i - 1, ], degree = 1, raw = FALSE)"
"0","    A[i, ] = round(mu[i] * A[i, ]) + mu[i]"
"0","  }"
"0","  "
"0","  R0 = matrix(0, ncol = d, nrow = d)"
"0","  lmat = replicate(d1/2, "
"0","                   matrix(1, ncol = 2, nrow = 2), "
"0","                   simplify = FALSE)"
"0","  R0_sub = as.matrix(Matrix::bdiag(lmat))"
"0","  R0_sub[R0_sub == 1] = cor(t(log(A[seq_len(d1), ] + 1)))[R0_sub == 1]"
"0","  R0[seq_len(d1), seq_len(d1)] = R0_sub"
"0","  "
"0","  # Sequencing efficiency"
"0","  C = rbeta(n = d, shape1 = 5, shape2 = 5)"
"0","  "
"0","  # Microbial loads in the ecosystem"
"0","  A_prim = A * C"
"0","  A_dot = colSums(A_prim)"
"0","  "
"0","  # Relative abundances in the ecosystem"
"0","  R = A_prim/t(replicate(d, A_dot))"
"0","  "
"0","  # Sampling fractions"
"0","  S = rbeta(n = n, shape1 = 2, shape2 = 10)"
"0","  "
"0","  # Library sizes"
"0","  O_dot = round(S * A_dot)"
"0","  # Observed abundances"
"0","  O = matrix(NA, nrow = d, ncol = n)"
"0","  for (i in seq(n)) {"
"0","    O[, i] = rmultinom(1, size = O_dot[i], prob = R[, i])"
"0","  }"
"0","  "
"0","  res = list(O = O, R0 = R0)"
"0","  return(res)"
"0","}"
"0",""
"0","n_d = c(""50_100"", ""100_200"")"
"0","d1 = 50"
"0","corr_mu = c(2000, 10000, 40000, 100000)"
"0","corr_prob = c(0.1, 0.4, 0.4, 0.1)"
"0","uncorr_mu = c(2000, 10000, 40000, 100000)"
"0","uncorr_prob = c(0.1, 0.4, 0.4, 0.1)"
"0","dispersion = c(0.5, 2)"
"0","iter_num = 100"
"0","seed = seq_len(iter_num)"
"0",""
"0","simparams = data.frame(expand.grid(n_d, dispersion, seed)) %>%"
"0","  separate(col = Var1, into = c(""n"", ""d""), sep = ""_"") %>%"
"0","  mutate(n = as.numeric(n),"
"0","         d = as.numeric(d))"
"0","colnames(simparams) = c(""n"", ""d"", ""dispersion"", ""seed"")"
"0","simparams = simparams %>%"
"0","  arrange(n, d, dispersion, seed)"
"0","simparams_list = apply(simparams, 1, paste0, collapse = ""_"")"
