"0","# Linear relationships"
"0","family_linear_time_30 = read_rds(""../data/nomic/family/linear_fam_30.rds"")"
"0","family_linear_time_120 = read_rds(""../data/nomic/family/linear_fam_120.rds"")"
"0","family_linear_time_365 = read_rds(""../data/nomic/family/linear_fam_365.rds"")"
"0","corr_family_linear_time_30 = family_linear_time_30$corr"
"0","corr_family_linear_time_120 = family_linear_time_120$corr"
"0","corr_family_linear_time_365 = family_linear_time_365$corr"
"0","p_family_linear_time_30 = family_linear_time_30$corr_p"
"0","p_family_linear_time_120 = family_linear_time_120$corr_p"
"0","p_family_linear_time_365 = family_linear_time_365$corr_p"
"0","cooccur_family_30 = family_linear_time_30$mat_cooccur"
"0","cooccur_family_120 = family_linear_time_120$mat_cooccur"
"0","cooccur_family_365 = family_linear_time_365$mat_cooccur"
"0",""
"0","# Filter by p-values"
"0","alpha = 0.1"
"0","corr_family_linear_time_30[p_family_linear_time_30 >= alpha] = 0"
"0","corr_family_linear_time_120[p_family_linear_time_120 >= alpha] = 0"
"0","corr_family_linear_time_365[p_family_linear_time_365 >= alpha] = 0"
"0",""
"0","# Filter by correlation coefficients"
"0","th = 0.1"
"0","corr_family_linear_time_30[abs(corr_family_linear_time_30) < th] = 0"
"0","corr_family_linear_time_120[abs(corr_family_linear_time_120) < th] = 0"
"0","corr_family_linear_time_365[abs(corr_family_linear_time_365) < th] = 0"
"0",""
"0","# Filter by co-occurrence"
"0","overlap = 10"
"0","corr_family_linear_time_30[cooccur_family_30 < overlap] = 0"
"0","corr_family_linear_time_120[cooccur_family_120 < overlap] = 0"
"0","corr_family_linear_time_365[cooccur_family_365 < overlap] = 0"
"0",""
"0","# Sort row and columns"
"0","corr_family_linear_time_30 = corr_family_linear_time_30[sort(rownames(corr_family_linear_time_30)),"
"0","                                                        sort(colnames(corr_family_linear_time_30))]"
"0","corr_family_linear_time_120 = corr_family_linear_time_120[sort(rownames(corr_family_linear_time_120)),"
"0","                                                          sort(colnames(corr_family_linear_time_120))]"
"0","corr_family_linear_time_365 = corr_family_linear_time_365[sort(rownames(corr_family_linear_time_365)),"
"0","                                                          sort(colnames(corr_family_linear_time_365))]"
"0",""
"0","df_family_linear = data.frame(get_upper_tri(corr_family_linear_time_30)) %>%"
"0","  rownames_to_column(""var1"") %>%"
"0","  pivot_longer(cols = -var1, names_to = ""var2"", values_to = ""value"") %>%"
"0","  mutate(day = ""Day 30"") %>%"
"0","  bind_rows("
"0","    data.frame(get_upper_tri(corr_family_linear_time_120)) %>%"
"0","    rownames_to_column(""var1"") %>%"
"0","    pivot_longer(cols = -var1, names_to = ""var2"", values_to = ""value"") %>%"
"0","    mutate(day = ""Day 120"")"
"0","  ) %>%"
"0","  bind_rows("
"0","    data.frame(get_upper_tri(corr_family_linear_time_365)) %>%"
"0","    rownames_to_column(""var1"") %>%"
"0","    pivot_longer(cols = -var1, names_to = ""var2"", values_to = ""value"") %>%"
"0","    mutate(day = ""Day 365"")"
"0","  ) %>%"
"0","  filter(!is.na(value)) %>%"
"0","  mutate(value = round(value, 2),"
"0","         metric = ""Linear"")"
"0",""
"0","# Distance relationships"
"0","family_dist_time_30 = read_rds(""../data/nomic/family/dist_fam_30.rds"")"
"0","family_dist_time_120 = read_rds(""../data/nomic/family/dist_fam_120.rds"")"
"0","family_dist_time_365 = read_rds(""../data/nomic/family/dist_fam_365.rds"")"
"0","corr_family_dist_time_30 = family_dist_time_30$dcorr"
"0","corr_family_dist_time_120 = family_dist_time_120$dcorr"
"0","corr_family_dist_time_365 = family_dist_time_365$dcorr"
"0","p_family_dist_time_30 = family_dist_time_30$dcorr_p"
"0","p_family_dist_time_120 = family_dist_time_120$dcorr_p"
"0","p_family_dist_time_365 = family_dist_time_365$dcorr_p"
"0",""
"0","# Filter by p-values"
"0","alpha = 0.01"
"0","corr_family_dist_time_30[p_family_dist_time_30 >= alpha] = 0"
"0","corr_family_dist_time_120[p_family_dist_time_120 >= alpha] = 0"
"0","corr_family_dist_time_365[p_family_dist_time_365 >= alpha] = 0"
"0",""
"0","# Filter by correlation coefficients"
"0","th = 0.1"
"0","corr_family_dist_time_30[abs(corr_family_dist_time_30) < th] = 0"
"0","corr_family_dist_time_120[abs(corr_family_dist_time_120) < th] = 0"
"0","corr_family_dist_time_365[abs(corr_family_dist_time_365) < th] = 0"
"0",""
"0","# Filter by co-occurrence"
"0","overlap = 10"
"0","corr_family_dist_time_30[cooccur_family_30 < overlap] = 0"
"0","corr_family_dist_time_120[cooccur_family_120 < overlap] = 0"
"0","corr_family_dist_time_365[cooccur_family_365 < overlap] = 0"
"0",""
"0","# Sort row and columns"
"0","corr_family_dist_time_30 = corr_family_dist_time_30[sort(rownames(corr_family_dist_time_30)),"
"0","                                                    sort(colnames(corr_family_dist_time_30))]"
"0","corr_family_dist_time_120 = corr_family_dist_time_120[sort(rownames(corr_family_dist_time_120)),"
"0","                                                      sort(colnames(corr_family_dist_time_120))]"
"0","corr_family_dist_time_365 = corr_family_dist_time_365[sort(rownames(corr_family_dist_time_365)),"
"0","                                                      sort(colnames(corr_family_dist_time_365))]"
"0",""
"0","df_family_dist = data.frame(get_upper_tri(corr_family_dist_time_30)) %>%"
"0","  rownames_to_column(""var1"") %>%"
"0","  pivot_longer(cols = -var1, names_to = ""var2"", values_to = ""value"") %>%"
"0","  mutate(day = ""Day 30"") %>%"
"0","  bind_rows("
"0","    data.frame(get_upper_tri(corr_family_dist_time_120)) %>%"
"0","    rownames_to_column(""var1"") %>%"
"0","    pivot_longer(cols = -var1, names_to = ""var2"", values_to = ""value"") %>%"
"0","    mutate(day = ""Day 120"")"
"0","  ) %>%"
"0","  bind_rows("
"0","    data.frame(get_upper_tri(corr_family_dist_time_365)) %>%"
"0","    rownames_to_column(""var1"") %>%"
"0","    pivot_longer(cols = -var1, names_to = ""var2"", values_to = ""value"") %>%"
"0","    mutate(day = ""Day 365"")"
"0","  ) %>%"
"0","  filter(!is.na(value)) %>%"
"0","  mutate(value = round(value, 2),"
"0","         metric = ""Distance"")"
"0",""
"0","# Merge datasets"
"0","df_family = df_family_linear %>%"
"0","  bind_rows("
"0","    df_family_dist"
"0","  )"
"0","fam_level = sort(union(df_family$var1, df_family$var2))"
"0","df_family$var1 = factor(df_family$var1, levels = fam_level)"
"0","df_family$var2 = factor(df_family$var2, levels = fam_level)"
"0","df_family$day = factor(df_family$day, levels = c(""Day 30"", ""Day 120"", ""Day 365""))"
"0","df_family$metric = factor(df_family$metric, levels = c(""Linear"", ""Distance""))"
"0",""
"0","# Bias corrected abundances"
"0","y_family_all = read_rds(""../data/nomic/family/y_hat_family.rds"")"
"0","y_family_time_30_all = exp(y_family_all$day30)"
"0","y_family_time_120_all = exp(y_family_all$day120)"
"0","y_family_time_365_all = exp(y_family_all$day365)"
"0",""
"0","family_keep_time_30 = rownames(family_linear_time_30$y_hat)"
"0","family_keep_time_120 = rownames(family_linear_time_120$y_hat)"
"0","family_keep_time_365 = rownames(family_linear_time_365$y_hat)"
"0",""
"0","ind30 = which(rownames(y_family_time_30_all) %in% family_keep_time_30)"
"0","y_family_time_30 = as.data.frame(y_family_time_30_all[ind30, ]) %>%"
"0","  bind_rows(as.data.frame(t(data.frame(Others = colSums(y_family_time_30_all[-ind30, ], na.rm = TRUE)))))"
"0",""
"0","ind120 = which(rownames(y_family_time_120_all) %in% family_keep_time_120)"
"0","y_family_time_120 = as.data.frame(y_family_time_120_all[ind120, ]) %>%"
"0","  bind_rows(as.data.frame(t(data.frame(Others = colSums(y_family_time_120_all[-ind120, ], na.rm = TRUE)))))"
"0",""
"0","ind365 = which(rownames(y_family_time_365_all) %in% family_keep_time_365)"
"0","y_family_time_365 = as.data.frame(y_family_time_365_all[ind365, ]) %>%"
"0","  bind_rows(as.data.frame(t(data.frame(Others = colSums(y_family_time_365_all[-ind365, ], na.rm = TRUE)))))"
